{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Matching Platform</title>
    <link rel="stylesheet" href="{% static 'css/footer.css' %}">
    <link rel="stylesheet" href="{% static 'css/matching.css' %}">
</head>

<body1>
    <div class="title-box">
        <h1>Matching Platform</h1>
    </div>
</body1>
<body2>
    <div class="menu">
        <div class="current-user">
            <div class="current-user-information">
                {% if current_user_profile.avatar %}
                    <img src="{{ current_user_profile.avatar.url }}" alt="Profile Picture">
                {% else %}
                    {% if current_user_profile.gender == 'M' %}
                        <img src="{% static 'images/male.png' %}" alt="Default Male Avatar">
                    {% elif current_user_profile.gender == 'F' %}
                        <img src="{% static 'images/female.png' %}" alt="Default Female Avatar">
                    {% else %}
                        <img src="{% static 'images/neutral.jpg' %}" alt="Default Neutral Avatar">
                    {% endif %}
                {% endif %}
                <p>{{ current_user_profile.user.username }}</p>
            </div>
            <div class="current-user-actions">
                <a href="{% url 'update_profile' username=current_user_profile.user.username %}" class="update-profile-button">Update Profile</a>
                <a href="{% url 'login' %}" class="log-out-button">Log Out</a>
            </div>
        </div>
        <div class="friend-list">
            <h3>My Friends</h3>
            <ul>
                {% for friend in friends %}
                    <li>{{ friend }}</li>
                {% empty %}
                    <li>No friends yet.</li>
                {% endfor %}
            </ul>
        </div>
        <div class="matching-request">
            <h3>Matching Requests</h3>
            <ul>
                {% for request in matching_requests_received %}
                    <li>{{ request }}</li>
                {% empty %}
                    <li>No matching requests yet.</li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <div class="content">
        <div class="form-container">
            <!-- 篩選表單 -->
            <form method="POST" action="{% url 'filter_function' %}">
                {% csrf_token %}
                <label for="destination">Destination:</label>
                <input type="text" id="destination" name="destination">
            
                <label for="age">Age:</label>
                <input type="number" id="age" name="age">
            
                <label for="exchange_school">Exchange School:</label>
                <input type="text" id="exchange_school" name="exchange_school">
            
                <label for="gender">Gender:</label>
                <select id="gender" name="gender">
                    <option value="">Select Gender</option>
                    <option value="M">Male</option>
                    <option value="F">Female</option>
                </select>
                <button type="submit">Filter</button>
                <button type="reset">Reset</button>
            </form>
            <!-- 顯示所有用戶的表單 -->
            <form method="GET" action="{% url 'show_all_profiles' %}">
                <!-- 保持 Show All 按钮为空白，以便在这里定义样式 -->
                <button type="submit" class="show-all">Show All</button>
            </form>
        </div>

        <!-- 自己的個人信息欄位 -->
        <div class="profile-container">

            <!-- 他人的個人信息欄位 -->
            {% for profile in profiles %}
            {% if profile.user != current_user_profile.user %} <!-- 這裡篩選掉自己的欄位 -->
            <div class="profile">
                {% if profile.avatar %}
                    <img src="{{ profile.avatar.url }}" alt="Profile Picture">
                {% else %}
                    {% if profile.gender == 'M' %}
                        <img src="{% static 'images/male.png' %}" alt="Default Male Avatar">
                    {% elif profile.gender == 'F' %}
                        <img src="{% static 'images/female.png' %}" alt="Default Female Avatar">
                    {% else %}
                        <img src="{% static 'images/neutral.jpg' %}" alt="Default Neutral Avatar">
                    {% endif %}
                {% endif %}
                <p>Name: {{ profile.user.username }}</p>
                <p>Destination: {{ profile.destination|default_if_none:"Not specified" }}</p>
                <p>Age: {{ profile.age|default_if_none:"Unknown" }}</p>
                <p>Exchange School: {{ profile.exchange_school|default_if_none:"Not specified" }}</p>
                <p>Gender: {{ profile.get_gender_display|default_if_none:"Not specified" }}</p>
                <!-- <div> -->
                <div class="profile-actions">
                    <!-- 縮小的 Match, Hide 和 Delete 按鈕 -->
                    <!-- <a href="{% url 'login' %}" class="button matching">Match</a>   -->
                    <a href="{% url 'user_matching' profile.user.username %}" class="button matching">Match</a> <!-- 使用 'user_matching' 名稱 -->
                    <a href="{% url 'hide_profile' profile.user.username %}" class="button hide" onclick="return confirm('Are you sure you want to hide this profile?');">Hide</a>
                    <a href="{% url 'delete_profile' profile.user.username %}" class="button delete" onclick="return confirm('Are you sure you want to delete this profile?');">Delete</a>
                </div>
            </div>
            {% endif %} <!-- 這裡結束自己的過濾條件 -->
            {% empty %}
            <p>No profiles found.</p>
            {% endfor %}
        </div>
    </div>
</body2>
</html>

<footer>
    <div class="footer-container">
        <div class="footer-text">© 2024 Spring PBC Final Project</div>
        <div class="footer-icon">
            <a href="https://github.com/Bai1026/PBC_Final_Project/tree/main" target="_blank">
                <img src="{% static 'images/github.png' %}" alt="Our GitHub" style="width:20px; height:20px;">
            </a>
            <a href="mailto:b09602017@ntu.edu.tw" target="_blank">
                <img src="{% static 'images/email.png' %}" alt="Our GitHub" style="width:20px; height:20px;">
            </a>
        </div>
    </div>
</footer>